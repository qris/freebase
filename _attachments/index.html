<!DOCTYPE html>
<html style="height: 100%;">
	<head>
		<title>Freebase</title>
		<link rel="stylesheet" href="style/main.css" type="text/css">
	</head>
	<body style="height: 100%; margin: 0; padding: 0;">
		<table style="width: 100%; height: 100%;">
			<tr>
				<td>
					<h1>Freebase</h1>
				</td>
			</tr>
			<tr style="height: 100%;">
				<td id="freebase" style="clear: both; border: 3px solid #ecc; height: 100%;"></td>
			</tr>
		</table>
	</body>

	<!--
	Skip vendor/couchapp/loader.js for now, because it loads an old version
	of jQuery (1.4.2) which has some bugs that stop us doing nice things
	like adding the isArray() method to Object's prototype.
	-->
	<!--<script src="vendor/couchapp/loader.js"></script>-->
	<script src="ext/jquery-1.5.2.js"></script>
	<script src="ext/MochiKit/Base.js"></script>
	<script src="ext/MochiKit/Async.js"></script>
	
	<script type="text/javascript" charset="utf-8">
		/*
		$.couch.app(function(app) {
		  $("#account").evently("account", app);
		  $("#profile").evently("profile", app);
		  $.evently.connect("#account","#profile", ["loggedIn","loggedOut"]);
		  $("#items").evently("items", app);
		});
		*/
	</script>

	<script src="ext/browser-couch.js"></script>
	<script src="src/Freebase.js"></script>
	<script type="text/javascript" charset="utf-8">
		$(document).ready(new Nest({},
			function(p, i)
			{
				Message = new Freebase.TableDocument('messages',
					[{name: "body", type: String}]);
				p.testDbContents = [
					Message.toDocument(),
					new Message({_id: "monkey", body: "hello there dude"}),
					new Message({_id: "chunky", body: "hello there dogen"})
				];
				
				p.baseUrl = window.location.protocol + "//" + window.location.host;
		
				jQuery.getJSON(p.baseUrl + "/", undefined, i.callback);
			},
			function(p, i)
			{
				var data = p.callbackArgs[0];
				var options = {};

				if ('couchdb' in data)
				{
					var dbname = window.location.pathname.substring(1,
						window.location.pathname.indexOf("/", 1));
					options.db_class = BrowserCouch.SameDomainDB;
					options.url = p.baseUrl + "/" + dbname;
				}

				p.db = BrowserCouch("blarg", options);
				p.db.post_multiple(p.testDbContents, i.callback, {replace_existing: true});
			},
			function(p, i)
			{
				BrowserCouch.ModuleLoader.require("JSON", i.callback);
			},
			function(p, i)
			{
				var fb = new Freebase(p.db);
				fb.themeDir = "ext/jquery-ui-themes/base";
				fb.run($("#freebase"), $);
			}
		));  // end iterator and document.ready()
	</script>
</html>
